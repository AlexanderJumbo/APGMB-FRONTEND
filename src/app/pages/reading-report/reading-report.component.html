<div class="container mx-auto p-4">
  <!-- Título -->
  <h2 class="text-2xl font-semibold mb-4 text-gray-800">
    Reporte de Lectura - Mes: {{ mesFormateado }}
  </h2>

  <!-- Selector de mes -->

  <!-- Botones -->
  <div class="mb-4 flex justify-end gap-4">
    <!-- Exportar PDF -->
    <button
      (click)="exportarPDF()"
      class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition"
      aria-label="Exportar PDF"
      [disabled]="lecturasSeleccionadas().length === 0"
      [ngClass]="{
        'opacity-50 cursor-not-allowed': lecturasSeleccionadas().length === 0
      }"
    >
      <svg
        class="h-5 w-5"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 14v4m-4-4v4m8-4v4m-4-4v4m-4-4h12M8 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2v-6m-6-8h6l-6-6v6z"
        />
      </svg>
      <span>Exportar PDF</span>
    </button>

    <!-- Guardar Cambios -->
    <button
      *ngIf="lecturasModificadas()"
      (click)="guardarCambios()"
      class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
      aria-label="Guardar Cambios"
    >
      <ng-container
        *ngIf="
          toastTipo() === 'success' &&
            toastMensaje() === 'Lecturas actualizadas correctamente.';
          else iconoLapiz
        "
      >
        <svg
          class="h-5 w-5 animate-bounce"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M5 13l4 4L19 7"
          />
        </svg>
      </ng-container>
      <ng-template #iconoLapiz>
        <svg
          class="h-5 w-5 animate-pulse"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M11 5h6m-6 0v6m0-6l-7 7-3 3v3h3l3-3 7-7z"
          />
        </svg>
      </ng-template>
      <span>Actualizar Consumo</span>
    </button>
  </div>

  <!-- Toast -->
  <div
    *ngIf="toastVisible()"
    class="fixed top-5 right-5 z-50 px-4 py-2 rounded shadow-lg flex items-center gap-2 text-sm"
    [ngClass]="{
      'bg-green-100 text-green-800': toastTipo() === 'success',
      'bg-yellow-100 text-yellow-800': toastTipo() === 'warning',
      'bg-red-100 text-red-800': toastTipo() === 'error'
    }"
    role="alert"
    aria-live="assertive"
  >
    <svg
      *ngIf="toastTipo() === 'warning'"
      class="w-5 h-5 animate-bounce"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 9v2m0 4h.01M12 5a7 7 0 110 14a7 7 0 010-14z"
      />
    </svg>
    <svg
      *ngIf="toastTipo() === 'success'"
      class="w-5 h-5 animate-bounce"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
    </svg>
    <svg
      *ngIf="toastTipo() === 'error'"
      class="w-5 h-5 animate-pulse"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M6 18L18 6M6 6l12 12"
      />
    </svg>
    <span>{{ toastMensaje() }}</span>
  </div>

  <!-- Tabla -->
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <table class="w-full text-sm text-left text-gray-500" role="table">
      <thead class="text-xs text-gray-700 uppercase bg-gray-100">
        <tr>
          <th class="px-4 py-3">
            <input
              type="checkbox"
              [checked]="todosSeleccionados()"
              (change)="toggleSeleccionarTodasDesdeEvento($event)"
              aria-label="Seleccionar todas las lecturas"
            />
          </th>
          <th class="px-4 py-3">Fecha</th>
          <th class="px-4 py-3">Cliente</th>
          <th class="px-4 py-3">Medidor</th>
          <th class="px-4 py-3">Sector</th>
          <th class="px-4 py-3">Anterior</th>
          <th class="px-4 py-3">Actual</th>
          <th class="px-4 py-3">Consumo Total</th>
          <th class="px-4 py-3">Observación</th>
          <th class="px-4 py-3">Operador</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let lectura of lecturas(); let i = index"
          [ngClass]="calcularTotal(lectura) < 0 ? 'bg-red-100' : 'bg-white'"
          class="border-b hover:bg-gray-50"
        >
          <td class="px-6 py-4">
            <input
              type="checkbox"
              [checked]="estaSeleccionado(lectura.idLecture)"
              (change)="
                toggleSeleccionarUnaDesdeEvento(lectura.idLecture, $event)
              "
              aria-label="Seleccionar lectura"
            />
          </td>
          <td class="px-6 py-4">{{ formatearFecha(lectura.dateLecture) }}</td>
          <td class="px-6 py-4">{{ lectura.accountUser }}</td>
          <td class="px-6 py-4">{{ lectura.accountMeter }}</td>
          <td class="px-6 py-4">{{ lectura.nameSector }}</td>
          <td class="px-6 py-4">{{ lectura.prevLecture }}</td>
          <td class="px-6 py-4">
            <input
              type="number"
              class="w-24 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              [value]="lectura.currentLecture"
              (change)="actualizarLectura(lectura, $event)"
              aria-label="Editar lectura actual"
              min="0"
            />
          </td>
          <td
            class="px-6 py-4 font-medium align-middle"
            [ngClass]="{
              'text-red-600': calcularTotal(lectura) < 0,
              'text-blue-600': calcularTotal(lectura) > 0
            }"
          >
            {{ calcularTotal(lectura) }}
          </td>
          <td class="px-6 py-4">{{ lectura.observation || "—" }}</td>
          <td class="px-6 py-4">{{ lectura.operatorName }}</td>
        </tr>

        <tr *ngIf="lecturas().length === 0">
          <td colspan="10" class="text-center py-6 text-gray-500 italic">
            No hay registros de consumo para mostrar.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
